/*
 *  Filename	: ExploitInfo.cpp
 *  Author		: Kuba Sejdak
 *  Created on	: 09-05-2012
 */

#include "ExploitInfo.h"

ExploitInfo::ExploitInfo()
{
    m_name = "";
    m_extractedFrom = "";
    m_graphName = "";
	m_size = 0;
    m_fileType = "unknown";
	m_fileSize = 0;
    m_codeOffset = 0;
	m_exploitPresent = false;
	m_traits = new TraitsMap();
	m_querys = new QList<QSqlQuery>();
	m_broken = false;
}

ExploitInfo::~ExploitInfo()
{
   TraitsMap::iterator it_map;
    for(it_map = m_traits->begin(); it_map != m_traits->end(); ++it_map)
        delete it_map.value();

    m_traits->clear();
    delete m_traits;

    m_querys->clear();
    delete m_querys;
}

void ExploitInfo::printInfo()
{
    cout << "\t name : " << m_name.toStdString() << endl;
    cout << "\t extracted from: " << m_extractedFrom.toStdString() << endl;
    cout << "\t graph name: " << m_graphName.toStdString() << endl;
	cout << "\t size : " << dec << m_size << endl;
    cout << "\t file type : " << m_fileType.toStdString() << endl;
	cout << "\t file size : " << dec << m_fileSize << endl;
	cout << "\t exploit present : " << (m_exploitPresent ? "yes" : "no") << endl;
	if(m_exploitPresent)
		cout << "\t exploit offset : 0x" << hex << m_codeOffset << endl;
	TraitsMap::iterator it;
	TraitsEntry::iterator it2;
    for(it = m_traits->begin(); it != m_traits->end(); ++it) {
        cout << "\t * " << it.key().toStdString() << " *" << "\t";
        for(it2 = it.value()->begin(); it2 != it.value()->end(); ++it2)
            cout << it2.key().toStdString() << " : " << it2.value().toStdString() << ", ";
		cout << endl << endl;
	}
}

QString ExploitInfo::name()
{
    return m_name;
}

QString ExploitInfo::extractedFrom()
{
    return m_extractedFrom;
}

QString ExploitInfo::graphName()
{
    return m_graphName;
}

int ExploitInfo::size()
{
	return m_size;
}

QString ExploitInfo::fileType()
{
    return m_fileType;
}

int ExploitInfo::fileSize()
{
	return m_fileSize;
}

int32_t ExploitInfo::codeOffset()
{
    return m_codeOffset;
}

bool ExploitInfo::isExploitPresent()
{
	return m_exploitPresent;
}

TraitsMap *ExploitInfo::traits()
{
    return m_traits;
}

QList<QSqlQuery> *ExploitInfo::querys()
{
    return m_querys;
}

bool ExploitInfo::isBroken()
{
	return m_broken;
}

void ExploitInfo::setName(QString name)
{
    m_name = name;
}

void ExploitInfo::setExtractedFrom(QString name)
{
    m_extractedFrom = name;
}

void ExploitInfo::setGraphName(QString name)
{
    m_graphName = name;
}

void ExploitInfo::setSize(int size)
{
	m_size = size;
}

void ExploitInfo::setFileType(QString fileType)
{
    m_fileType = fileType;
}

void ExploitInfo::setFileSize(int fileSize)
{
	m_fileSize = fileSize;
}

void ExploitInfo::setCodeOffset(int codeOffset)
{
    m_codeOffset = codeOffset;
}

void ExploitInfo::setExploitPresent(bool exploitPresent)
{
	m_exploitPresent = exploitPresent;
}

void ExploitInfo::setTrait(QString name, TraitsEntry *value)
{
	/* ensure that key/value is unique */
    if(m_traits->contains(name, value))
        return;

    m_traits->insert(name, value);
}

void ExploitInfo::setQuery(QSqlQuery q)
{
    m_querys->push_back(q);
}

void ExploitInfo::setBroken(bool broken)
{
	m_broken = broken;
}
